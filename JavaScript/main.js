

let Layout8 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0x80, 0xc0, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0xc0, 0x80, 0x84, 0x81, 0x84, 0x81, 0xc0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0x00, 0x07,
    0x00, 0x06,
    0x00, 0x08
]

let Layout7 = [
    0xc0, 0x80, 0x82, 0x88, 0x82, 0x88, 0xc0, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0x80, 0xc0, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0x00, 0x07,
    0x00, 0x06,
    0x00, 0x08
]

let Layout6 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0xc0, 0xff, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x40, 0xff, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff, 0xff,
    0x40, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff, 0xff,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0xc0, 0xff, 0xff,
    0x00, 0x06,
    0x00, 0x07,
    0x00, 0x08
]

let Layout5 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0x80, 0xc0, 0xff,
    0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xff,
    0xc0, 0x80, 0x84, 0x81, 0x84, 0x81, 0xc0, 0xff,
    0x00, 0x07,
    0x00, 0x07,
    0x00, 0x08
]

let Layout4 = [
    0xc0, 0x80, 0x82, 0x88, 0x82, 0x88, 0xc0, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff,
    0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0x80, 0xc0, 0xff,
    0x00, 0x07,
    0x00, 0x07,
    0x00, 0x08
]

let Layout3 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0x82, 0x88, 0xc0,
    0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0x84, 0x81, 0xc0,
    0x00, 0x08,
    0x00, 0x07,
    0x00, 0x0a
]

let Layout2 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0x82, 0x88, 0xc0,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48,
    0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x41,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0x84, 0x81, 0xc0,
    0x00, 0x08,
    0x00, 0x07,
    0x00, 0x0a
]

let Layout1 = [
    0xc0, 0x82, 0x88, 0x82, 0x88, 0xc0, 0xff, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff, 0xff,
    0x42, 0x00, 0x00, 0x00, 0x00, 0x48, 0xff, 0xff,
    0x44, 0x00, 0x00, 0x00, 0x00, 0x41, 0xff, 0xff,
    0xc0, 0x84, 0x81, 0x84, 0x81, 0xc0, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0x00, 0x06,
    0x00, 0x06,
    0x00, 0x08
]

let levelLayouts = [
    Layout1,
    Layout2,
    Layout3,
    Layout4,
    Layout5,
    Layout6,
    Layout7,
    Layout8
]

//シュッポッ、シュッポッ、シュッポッポッ。シュッポッ、シュッポッ、シュッポッポッ。
//うーさちゃん列車がはしってる。にんじん取れるかな。
//うーさちゃん列車が
//うさちゃん列車が
let lyrics = [
    "シュッポッ、シュッポッ",
    "シュッポッポッ。",
    "シュッポッ、シュッポッ",
    "シュッポッポッ。",
    "うーさちゃん",
    "列車が",
    "はしってる。",
    "にんじん",
    "取れるかな。"
]
let lyricsEng = [
    "Shuppo, Shuppo",
    "Shuppoppo.",
    "Shuppo, Shuppo",
    "Shuppoppo.",
    "Bunny train is",
    "running. lets see",
    "if you can take the",
    "carrot."
]



let ptArr = [
    {x:  0, y: -1 },
    {x:  1, y:  0 },
    {x:  0, y:  1 },
    {x: -1, y:  0 }
]

let Edge  = 0x00C0
let Empty = 0x00FF



var glob6 = true     // demonstration
var glob7 


var glob16 = false
var glob17
// var glob23 = 18 // status bar
var glob24 = 64 // tile width
var glob25 = 24
var glob26;
var glob27 = true     // setup needed
var glob28 = false    // load next level
var glob29 = false    // use music
var glob30 = false    // rush
var glob31 = 0  // score
var glob32      // bonus
var glob33
var glob34

var glob36      // number of lives
var glob37      // number of carrots
var glob38      // max speed
var glob39 = 1  // dificulty

var glob41 = [] // level tiles  // tiles on the board

var glob45 = 3  // level number
var glob46

var glob47      // the canvas
var glob48      // hiddenCanvas

var glob50      // canvas context

var glob52      // hiddenCanvas context
var glob53

var glob55      // rabbit canvas
var glob56      //
var glob57      // board width
var glob58      // board height
var glob59      // edge groups
var glob60      // empty tile x index
var glob61      // empty tile y index
var glob62      // empty tile x index
var glob63      // empty tile y index
var glob64 = 0  //                      length?
var glob65      // direction
var glob66

var glob70      // rect


// let glob2   = { 0x0000, 0x0000, 0x0000 };
// let glob4   = { 0x9922, 0x00DD, 0x22CC };

// let glob18  = { 0x0000, 0x0000, 0x0000 }; // mask off
// let glob19  = { 0xFFFF, 0xFFFF, 0xFFFF }; // mask on

//RGBColor glob18  = { 0X9922, 0x00DD, 0x22CC }; // mask off
//RGBColor glob19  = { 0x99AA, 0x9911, 0x2211 }; // mask on


// let glob20  = { 0xAFC8, 0xAFC8, 0xAFC8 }; // light gray

// let glob21  = { 0x2710, 0x3A98, 0x32C8 }; // dark dark gray
// let glob22  = { 0xFDE8, 0xFDE8, 0xFDE8 };

let glob18 = "#000000"
let glob19 = "#FFFFFF"

let glob132 = "#920D2C"
let glob134 = "#66FFCC" // aquamarine
let glob136 = "#FFFFFF"
//glob138 =
let glob138 = "#FF0000"
let glob140 = "#000000"

let glob151 = "#920D2C"
let glob155 = "#9A9121"

var glob126 = false // shrink
var glob159 = false
var glob160 = false // crashed

var glob161 = false // played loop sound
var glob162 = false    // should recover
var glob171     // time un_paused
var glob172

var glob174     // crash time
var glob175 = false     // pause drawn


var glob180     // rabbit canvas
var glob181     // rabbit canvas context
var glob182
var glob183     // use sound
var glob184     // does sound channel exist
var glob185     // sound channel
var glob186     // last tile value
var glob187     // steps in edge closing;
var glob188;    // x to close
var glob189;    // y to close
var glob190;    // x to close
var glob191;    // y to close
var glob192 //= new Rect(0,0,0,0)
var glob193 //= new Rect(0,0,0,0)


var glob196     // theme

var pen

var ctx

function PenSize(w) {
    ctx.lineWidth = w
}




var loadTime
function TickCount() {
    var nowTime = new Date().getTime()
    return Math.round( 60 * (nowTime - loadTime) / 1000 )
    // return Math.round(  (nowTime - loadTime) / 1000 )
    // return Math.round( 1000 * (nowTime - loadTime) / 60 )
}

var A5 = []








var Arr15E = [
    0x18, 0x18, 0x16, 0x11, // 0    , 1     , 2     , 3
    0x0A, 0x03, 0x00, 0x00, // 4    ,
    0x04, 0x0C, 0x13, 0x19, // 8    ,
    0x1C, 0x20, 0x00, 0x00, // 12   ,
    0x01, 0x1D, 0x03, 0x05, // 16   ,
    0x06, 0x07, 0x00, 0x00, // 20   ,
    0x06, 0x03              // off12,    offset6
] // right edge down to left
var Arr192 = [
    0x03, 0x0A, 0x11, 0x16,
    0x18, 0x18, 0x00, 0x00,
    0x20, 0x1C, 0x19, 0x13,
    0x0C, 0x04, 0x00, 0x00,
    0x15, 0x14, 0x13, 0x11,
    0x0F, 0x1F, 0x00, 0x00,
    0x06, 0x00
] // right edge right to up
var Arr1C6 = [
    0x3D, 0x36, 0x2F, 0x2C,
    0x28, 0x28, 0x00, 0x00,
    0x20, 0x1C, 0x19, 0x13,
    0x0C, 0x04, 0x00, 0x00,
    0x09, 0x0A, 0x0B, 0x0D,
    0x0F, 0x1F, 0x00, 0x00,
    0x06, 0x00
] // left edge left to up
var Arr1FA = [
    0x28, 0x28, 0x2C, 0x2F,
    0x36, 0x3D, 0x00, 0x00,
    0x04, 0x0C, 0x13, 0x19,
    0x1C, 0x20, 0x00, 0x00,
    0x01, 0x1D, 0x1B, 0x19,
    0x18, 0x17, 0x00, 0x00,
    0x06, 0x01
] // left edge down to right
var Arr22E = [
    0x28, 0x28, 0x2C, 0x2F,
    0x36, 0x3D, 0x00, 0x00,
    0x3C, 0x34, 0x2D, 0x27,
    0x24, 0x20, 0x00, 0x00,
    0x0F, 0x1F, 0x11, 0x13,
    0x14, 0x15, 0x00, 0x00,
    0x06, 0x01
] // left edge up to right
var Arr262 = [
    0x3D, 0x36, 0x2F, 0x2C,
    0x28, 0x28, 0x00, 0x00,
    0x20, 0x24, 0x27, 0x2D,
    0x34, 0x3C, 0x00, 0x00,
    0x07, 0x06, 0x05, 0x03,
    0x01, 0x1D, 0x00, 0x00,
    0x06, 0x02
] // left edge left to down
var Arr296 = [
    0x03, 0x0A, 0x11, 0x16,
    0x18, 0x18, 0x00, 0x00,
    0x20, 0x24, 0x27, 0x2D,
    0x34, 0x3C, 0x00, 0x00,
    0x17, 0x18, 0x19, 0x1B,
    0x01, 0x1D, 0x00, 0x00,
    0x06, 0x02
] // right edge right to down
var Arr2CA = [
    0x18, 0x18, 0x16, 0x11,
    0x0A, 0x03, 0x00, 0x00,
    0x3C, 0x34, 0x2D, 0x27,
    0x24, 0x20, 0x00, 0x00,
    0x0F, 0x1F, 0x0D, 0x0B,
    0x0A, 0x09, 0x00, 0x00,
    0x06, 0x03
] // right edge up to left

var Arr2FE = [
    0x20, 0x1C, 0x19, 0x13,
    0x0C, 0x04, 0x00, 0x00, 
    0x03, 0x0A, 0x11, 0x16, 
    0x18, 0x18, 0x00, 0x00, 
    0x02, 0x03, 0x04, 0x06, 
    0x08, 0x1E, 0x00, 0x00,
    0x06, 0x03
] // right edge down to left
var Arr332 = [
    0x04, 0x0C, 0x13, 0x19,
    0x1C, 0x20, 0x00, 0x00,
    0x18, 0x18, 0x16, 0x11,
    0x0A, 0x03, 0x00, 0x00,
    0x16, 0x20, 0x14, 0x12,
    0x11, 0x10, 0x00, 0x00,
    0x06, 0x00,
]
var Arr366 = [
    0x3C, 0x34, 0x2D, 0x27,
    0x24, 0x20, 0x00, 0x00,
    0x18, 0x18, 0x16, 0x11,
    0x0A, 0x03, 0x00, 0x00,
    0x08, 0x1E, 0x0A, 0x0C,
    0x0D, 0x0E, 0x00, 0x00,
    0x06, 0x00,
]
var Arr39A = [
    0x20, 0x24, 0x27, 0x2D,
    0x34, 0x3C, 0x00, 0x00,
    0x03, 0x0A, 0x11, 0x16,
    0x18, 0x18, 0x00, 0x00,
    0x1C, 0x1B, 0x1A, 0x18,
    0x16, 0x20, 0x00, 0x00,
    0x06, 0x01
]
var Arr3CE = [
    0x20, 0x24, 0x27, 0x2D,
    0x34, 0x3C, 0x00, 0x00,
    0x3D, 0x36, 0x2F, 0x2C,
    0x28, 0x28, 0x00, 0x00,
    0x10, 0x11, 0x14, 0x20,
    0x16, 0x20, 0x00, 0x00,
    0x06, 0x01
]

var Arr402 = [
    0x3C, 0x34, 0x2D, 0x27,
    0x24, 0x20, 0x00, 0x00,
    0x28, 0x28, 0x2C, 0x2F,
    0x36, 0x3D, 0x00, 0x00,
    0x08, 0x1E, 0x06, 0x04,
    0x03, 0x02, 0x00, 0x00,
    0x06, 0x02
]
var Arr436 = [
    0x04, 0x0C, 0x13, 0x19,
    0x1C, 0x20, 0x00, 0x00,
    0x28, 0x28, 0x2C, 0x2F,
    0x36, 0x3D, 0x00, 0x00,
    0x16, 0x20, 0x18, 0x1A,
    0x1B, 0x1C, 0x00, 0x00,
    0x06, 0x02
]
var Arr46A = [
    0x20, 0x1C, 0x19, 0x13,
    0x0C, 0x04, 0x00, 0x00,
    0x3D, 0x36, 0x2F, 0x2C,
    0x28, 0x28, 0x00, 0x00,
    0x0E, 0x0D, 0x0C, 0x0A,
    0x08, 0x1E, 0x00, 0x00,
    0x06, 0x03
]
var Arr49E = [
    0x04, 0x0C, 0x14, 0x1C,
    0x24, 0x2C, 0x34, 0x3C,
    0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20,
    0x16, 0x20, 0x16, 0x20,
    0x16, 0x20, 0x16, 0x20,
    0x08, 0x01
] // straight right

var Arr4D2 = [
    0x3C, 0x34, 0x2C, 0x24,
    0x1C, 0x14, 0x0C, 0x04,
    0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20,
    0x08, 0x1E, 0x08, 0x1E,
    0x08, 0x1E, 0x08, 0x1E,
    0x08, 0x03
] // straight left

var Arr506 = [
    0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20,
    0x3A, 0x32, 0x2A, 0x24,
    0x1C, 0x14, 0x0C, 0x04,
    0x0F, 0x1F, 0x0F, 0x1F,
    0x0F, 0x1F, 0x0F, 0x1F,
    0x08, 0x00
] // straight up

var Arr53A = [
    0x20, 0x20, 0x20, 0x20,
    0x20, 0x20, 0x20, 0x20,
    0x04, 0x0C, 0x14, 0x1C,
    0x24, 0x2A, 0x32, 0x3A,
    0x01, 0x1D, 0x01, 0x1D,
    0x01, 0x1D, 0x01, 0x1D,
    0x08, 0x02
] // straight down

var Arr56E = [
    0x3D, 0x37, 0x31, 0x2C,
    0x27, 0x24, 0x21, 0x20,
    0x20, 0x1F, 0x1C, 0x19,
    0x14, 0x0F, 0x09, 0x03,
    0x08, 0x09, 0x0A, 0x0B,
    0x0C, 0x0D, 0x0E, 0x1F,
    0x08, 0x00
] // left then up

var Arr5A2 = [
    0x20, 0x21, 0x24, 0x27,
    0x2C, 0x31, 0x37, 0x3D,
    0x03, 0x09, 0x0F, 0x14,
    0x19, 0x1C, 0x1F, 0x20,
    0x01, 0x1C, 0x1B, 0x1A,
    0x19, 0x18, 0x17, 0x20,
    0x08, 0x01
] // down then right

var Arr5D6 = [
    0x03, 0x09, 0x0F, 0x14,
    0x19, 0x1C, 0x1F, 0x20,
    0x20, 0x21, 0x24, 0x27,
    0x2C, 0x31, 0x37, 0x3D,
    0x16, 0x17, 0x18, 0x19,
    0x1A, 0x1B, 0x1C, 0x1D,
    0x08, 0x02
] // right then down

var Arr60A = [
    0x20, 0x1F, 0x1C, 0x19,
    0x14, 0x0F, 0x09, 0x03,
    0x3D, 0x37, 0x31, 0x2C,
    0x27, 0x24, 0x21, 0x20,
    0x0F, 0x0E, 0x0D, 0x0C,
    0x0B, 0x0A, 0x09, 0x1E,
    0x08, 0x03
] // up then left

var Arr63E = [
    0x20, 0x21, 0x24, 0x27,
    0x2C, 0x31, 0x37, 0x3D,
    0x3D, 0x37, 0x31, 0x2C,
    0x27, 0x24, 0x21, 0x20,
    0x0F, 0x10, 0x11, 0x12,
    0x13, 0x14, 0x15, 0x20,
    0x08, 0x01
] // up then right

var Arr672 = [
    0x3D, 0x37, 0x31, 0x2C,
    0x27, 0x24, 0x21, 0x20,
    0x20, 0x21, 0x24, 0x27,
    0x2C, 0x31, 0x37, 0x3D,
    0x08, 0x07, 0x06, 0x05,
    0x04, 0x03, 0x02, 0x1D,
    0x08, 0x02
] // left then down
var Arr6A6 = [
    0x20, 0x1F, 0x1C, 0x19,
    0x14, 0x0F, 0x09, 0x03,
    0x03, 0x09, 0x0F, 0x14,
    0x19, 0x1C, 0x1F, 0x20,
    0x01, 0x02, 0x03, 0x04,
    0x05, 0x06, 0x07, 0x1E,
    0x08, 0x03
] // down then left

var Arr6DA = [
    0x03, 0x09, 0x0F, 0x14,
    0x19, 0x1C, 0x1F, 0x20,
    0x20, 0x1F, 0x1C, 0x19,
    0x14, 0x0F, 0x09, 0x03,
    0x16, 0x15, 0x14, 0x13,
    0x12, 0x11, 0x10, 0x1F,
    0x08, 0x00
] // right then up

var Arr12A = [
    Arr332, // 0
    Arr436, // 1
    Arr46A, // 2
    Arr3CE, // 3
    Arr402, // 4
    Arr366, // 5
    Arr39A, // 6
    Arr2FE, // 7    right edge down to left
    Arr192, // 8    right edge right to up
    Arr296, // 9    right edge right to down
    Arr2CA, // 10   right edge up    to left
    Arr22E, // 11   left  edge up    to right
    Arr262, // 12   left  edge left  to down
    Arr1C6, // 13   left  edge left  to up
    Arr1FA, // 14   left  edge down  to right
    Arr15E, // 15   right edge down  to left
    Arr49E, // 16   right
    Arr6DA, // 17   right then up
    Arr5D6, // 18   right then down
    Arr506, // 19   up                          // should start here
    Arr60A, // 20   up    then left
    Arr63E, // 21   up    then right
    Arr4D2, // 22   left
    Arr672, // 23   left  then down
    Arr56E, // 24   left  then up
    Arr53A, // 25   down
    Arr5A2, // 26   down  then right
    Arr6A6, // 27   down  then left
]

var ArrBA = [
    0x01, // v< 00
    0x04, // ^< 01
    0x10, // ^v 02
    0x04, // ^< 03
    0x02, // ^> 04
    0x20, // <> 05
    0x02, // ^> 06
    0x08, // v> 07
    0x10, // ^v 08
    0x08, // v> 09
    0x01, // v< 10
    0x20, // <> 11
    0x01, // v< 12
    0x04, // ^< 13
    0x04, // ^< 14
    0x02, // ^> 15
    0x02, // ^> 16
    0x08, // v> 17
    0x08, // v> 18
    0x01, // v< 19
    0x01, // v< 20
    0x04, // ^< 21
    0x04, // ^< 22
    0x02, // ^> 23
    0x02, // ^> 24
    0x08, // v> 25
    0x08, // v> 26
    0x01, // v< 27
]












var arr1308 = new Array(9)